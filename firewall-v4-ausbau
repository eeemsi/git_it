#echo "flashing old rules"
#iptables -F

echo "setting up rules for iptables..."
#policies
iptables -P OUTPUT ACCEPT
iptables -P INPUT DROP
iptables -P FORWARD DROP
 
iptables -N SERVICES
 
#drop spoofed packets
iptables -A INPUT ! --in-interface lo --source 127.0.0.0/8 -j DROP
 
#limit ping requests
 
iptables -A INPUT -p icmp -m icmp -m limit --limit 1/second -j ACCEPT
 
#drop bogus packets
iptables -A INPUT -m state --state INVALID -j DROP
iptables -A FORWARD -m state --state INVALID -j DROP
iptables -A OUTPUT -m state --state INVALID -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags FIN,ACK FIN -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags ACK,PSH PSH -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags ACK,URG URG -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags FIN,RST FIN,RST -j DROP
iptables -t filter -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -j DROP
 
#allowed inputs
iptables -A INPUT --in-interface lo -j ACCEPT
iptables -A INPUT -j SERVICES
 
#allow responses
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
 
#
#
#allow services
#
#
 
#Force SYN packets check
iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP
 
#Force Fragments packets check
iptables -A INPUT -f -j DROP
 
#XMAS packets
iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP
 
#Drop all NULL packets
iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP
echo "rules set" 
